package com.wushengde.lob;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.InputStream;
import java.io.Reader;
import java.io.Writer;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import org.junit.Test;

import com.wushengde.util.JDBCUtils;

/*
	create table blobdemo(
	id int primary key auto_increment,
	name varchar(100),
	content MEDIUMBLOB
	);
*/
public class BlobDemo01 {
	
	
	@Test
	public void findBlob(){
		Connection conn = null;
		PreparedStatement ps = null;
		ResultSet rs = null;
		try{
			conn = JDBCUtils.getConn();
			ps = conn.prepareStatement("select * from blobdemo");
			rs =ps.executeQuery();
			while(rs.next()){
				 String filename = rs.getString("name");
				 Reader reader =rs.getCharacterStream("content");
				 Writer writer=new FileWriter(filename);
				 
				 char[] cs= new char[1024];
				 int i = 0;
				 while((i=reader.read(cs))!=-1){
					 writer.write(cs,0,i);
				 }
				 reader.close();
				 writer.close();
			}
		}catch (Exception e) {
			e.printStackTrace();
		}finally{
			JDBCUtils.close(rs, ps, conn);
		}
		
	}
	//向数据库中存入大的二进制文件（此处存的是mp3，也可以存大的视频等，但是注意数据中内容字段的类型的设置，单个视频最大只能存4G）
	@Test
	public void addBlob(){
		
		Connection conn = null;
		PreparedStatement ps = null;
		ResultSet rs = null;
		try{
			conn = JDBCUtils.getConn();
			ps = conn.prepareStatement("insert into blobdemo values (null,?,?)");
			ps.setString(1, "洛天依.mp3");
			File file = new File("b.mp3");
			ps.setBinaryStream(2, new FileInputStream(file),(int)file.length());
			ps.executeUpdate();
		}catch (Exception e) {
			e.printStackTrace();
		}finally{
			JDBCUtils.close(rs, ps, conn);
		}
	}
}
